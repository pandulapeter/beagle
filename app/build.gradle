apply plugin: "com.android.application"
apply plugin: "kotlin-android"
apply plugin: "kotlin-parcelize"
apply plugin: "kotlin-kapt"

android {
    compileSdkVersion libraryCompileSdkVersion
    defaultConfig {
        applicationId "com.pandulapeter.beagle"
        minSdkVersion libraryMinimumSdkVersion
        targetSdkVersion libraryTargetSdkVersion
        versionCode 22
        versionName "1.2.7"
        buildConfigField("String", "BUILD_DATE", "\"${new Date().format("yyyy-MM-dd")}\"")
        buildConfigField("String", "BEAGLE_VERSION", "\"$libraryVersion\"")
        vectorDrawables.useSupportLibrary = true
    }
    compileOptions {
        sourceCompatibility 1.8
        targetCompatibility 1.8
    }
    signingConfigs {
        internal {
            keyAlias "androiddebugkey"
            keyPassword "android"
            storeFile file("internal.keystore")
            storePassword "android"
        }
        release {
            keyAlias "androiddebugkey"
            keyPassword "android"
            storeFile file("internal.keystore")
            storePassword "android"
        }
    }
    buildFeatures.dataBinding = true
    buildTypes {
        debug {
            debuggable true
            minifyEnabled false
            shrinkResources false
            multiDexEnabled true
            applicationIdSuffix ".debug"
            versionNameSuffix "-debug"
            signingConfig signingConfigs.internal
        }
        internal {
            debuggable false
            minifyEnabled true
            shrinkResources true
            multiDexEnabled false
            applicationIdSuffix ".internal"
            versionNameSuffix "-internal"
            signingConfig signingConfigs.internal
            proguardFiles getDefaultProguardFile("proguard-android-optimize.txt"), "proguard-rules.pro"
            matchingFallbacks = ["debug"]
        }
        release {
            debuggable false
            minifyEnabled true
            shrinkResources true
            multiDexEnabled false
            applicationIdSuffix ".release"
            versionNameSuffix "-release"
            signingConfig signingConfigs.release
            proguardFiles getDefaultProguardFile("proguard-android-optimize.txt"), "proguard-rules.pro"
        }
    }
    flavorDimensions "beagle-ui"
    productFlavors {
        activity {
            applicationIdSuffix ".activity"
            versionNameSuffix "-activity"
        }
        bottomSheet {
            applicationIdSuffix ".bottomSheet"
            versionNameSuffix "-bottom-sheet"
        }
        dialog {
            applicationIdSuffix ".dialog"
            versionNameSuffix "-dialog"
        }
        drawer {
            applicationIdSuffix ".drawer"
            versionNameSuffix "-drawer"
        }
        view {
            applicationIdSuffix ".view"
            versionNameSuffix "-view"
        }
    }
}

configurations {
    activityDebugImplementation
    activityInternalImplementation
    bottomSheetDebugImplementation
    bottomSheetInternalImplementation
    dialogDebugImplementation
    dialogInternalImplementation
    drawerDebugImplementation
    drawerInternalImplementation
    viewDebugImplementation
    viewInternalImplementation
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation "androidx.multidex:multidex:2.0.1"
    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:$coroutinesVersion"
    implementation "androidx.appcompat:appcompat:1.3.0-alpha02" //TODO: Use $appCompatVersion once 1.3.0 becomes stable
    implementation "androidx.lifecycle:lifecycle-viewmodel-ktx:$lifecycleVersion"
    implementation "com.google.android.material:material:$materialVersion"
    implementation "androidx.constraintlayout:constraintlayout:$constraintLayoutVersion"
    implementation "org.koin:koin-androidx-viewmodel:2.1.6"
    implementation("com.squareup.retrofit2:retrofit:$retrofitVersion") { exclude module: "okhttp" }
    implementation "com.squareup.okhttp3:okhttp:$okHttpVersion"
    implementation "androidx.recyclerview:recyclerview:1.2.0-beta01" //TODO: Use $recyclerViewVersion once 1.2.0 becomes stable
    implementation "com.squareup.retrofit2:converter-moshi:$retrofitVersion"
    implementation "io.ktor:ktor-client-android:$ktorVersion"
    implementation "io.ktor:ktor-client-gson:$ktorVersion"
    implementation "com.android.billingclient:billing:3.0.2"
    implementation "com.squareup.moshi:moshi-kotlin:$moshiVersion"
    kapt "com.squareup.moshi:moshi-kotlin-codegen:$moshiVersion"
    debugImplementation "com.squareup.leakcanary:leakcanary-android:$leakCanaryVersion"
    implementation project(":utils")
    activityDebugImplementation project(":ui-activity")
    activityDebugImplementation project(":log")
    activityDebugImplementation project(":log-okhttp")
    activityDebugImplementation project(":log-ktor")
    activityInternalImplementation project(":ui-activity")
    activityInternalImplementation project(":log")
    activityInternalImplementation project(":log-okhttp")
    activityInternalImplementation project(":log-ktor")
    bottomSheetDebugImplementation project(":ui-bottom-sheet")
    bottomSheetDebugImplementation project(":log")
    bottomSheetDebugImplementation project(":log-okhttp")
    bottomSheetDebugImplementation project(":log-ktor")
    bottomSheetInternalImplementation project(":ui-bottom-sheet")
    bottomSheetInternalImplementation project(":log")
    bottomSheetInternalImplementation project(":log-okhttp")
    bottomSheetInternalImplementation project(":log-ktor")
    dialogDebugImplementation project(":ui-dialog")
    dialogDebugImplementation project(":log")
    dialogDebugImplementation project(":log-okhttp")
    dialogDebugImplementation project(":log-ktor")
    dialogInternalImplementation project(":ui-dialog")
    dialogInternalImplementation project(":log")
    dialogInternalImplementation project(":log-okhttp")
    dialogInternalImplementation project(":log-ktor")
    drawerDebugImplementation project(":ui-drawer")
    drawerDebugImplementation project(":log")
    drawerDebugImplementation project(":log-okhttp")
    drawerDebugImplementation project(":log-ktor")
    drawerInternalImplementation project(":ui-drawer")
    drawerInternalImplementation project(":log")
    drawerInternalImplementation project(":log-okhttp")
    drawerInternalImplementation project(":log-ktor")
    viewDebugImplementation project(":ui-view")
    viewDebugImplementation project(":log")
    viewDebugImplementation project(":log-okhttp")
    viewDebugImplementation project(":log-ktor")
    viewInternalImplementation project(":ui-view")
    viewInternalImplementation project(":log")
    viewInternalImplementation project(":log-okhttp")
    viewInternalImplementation project(":log-ktor")
    releaseImplementation project(":noop")
    releaseImplementation project(":log-noop")
    releaseImplementation project(":log-okhttp-noop")
    releaseImplementation project(":log-ktor-noop")
}

tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all {
    kotlinOptions {
        jvmTarget = "1.8"
        freeCompilerArgs = ["-Xjvm-default=all"]
    }
}